---
emoji: 🔥
title: JWT(JSON Web Token)
date: '2022-11-09 00:00:00'
author: Steadystudy
tags: CS공부
categories: CS공부
---

# JWT(JSON Web Token)

당사자 간에 정보를 JSON 개체로 안전하게 정보를 전송하기 위한 간결한 token이다.  
JWT는 **인가**에 연관된 기술인데 여기서 **인증**과 **인가**에 대해 간략하게 알아보자.

### 인증

인증(Authentication)? **(식별가능한 정보로) 서비스에 등록된 유저의 신원을 입증하는 과정**  
쉽게 말해서 로그인이라고 생각하면 된다. 즉, 특정 서비스에 일정 권한이 주어진 사용자임을 아이디랑 패스워드 등을 통해서 인증을 받는 것이다.

### 인가

인가(Authorization)? **자원을 적절한/유효한 사용자에게 전달/공개 하기 위한 방법**  
즉 로그인을 하고 나서 내 친구들의 목록을 보거나 글을 작성하는 등 내 계정으로'만' 할 수 있는 일을 하는 것이다.

### JWT는 언제 사용해야 하는가?

- 권한 부여: 사용자가 로그인하면 각 후속 요청에는 JWT가 포함되어 사용자가 해당 토큰으로 허용되는 경로, 서비스 및 리소스에 엑세스할 수 있다.
- 정보 교환: 서비스가 사용자에게 이 토큰을 통해 공개하기 원하는 내용을 서비스 측에서 원하는 대로 담을 수 있다.
  이렇게 토큰에 담긴 사용자 정보 등의 데이터를 **Claim**이라고 한다.

### JWT 웹 토큰 구조

JWT는 'XXXX.YYYY.ZZZZ' 같이 '.' 2개를 기준으로 첫 번째는 Header, 두 번째는 Payload, 세 번째는 Signature를 뜻한다.

- Header
  - type: 이건 항상 JWT이다.
  - alg: 알고리즘의 약자이다. 여러 암호화 방식 중 하나를 지정할 수 있다. ex) 'HS256'
  - JWT의 첫 번째 부분을 형성한다.
  ```
  {
    "alg": "HS256",
    "typ": "JWT"
  }
  ```
  -
- Payload
  - 사용자 정보 및 추가 데이터에 대한 설명 즉,**Claim**을 포함한다.
  - payload는 **Base64Url**로 인코딩되어 JWT의 두 번째 부분을 형성한다.
  ```
  {
    "sub": "123456",
    "name": "Steadystudy",
    "admin": true
  }
  ```
- Signature
  - 인코딩된 페이로드, 암호, 헤더에 지정된 알고리즘을 가져와서 확인을 해야 한다.
  - 메시지가 도중에 변경되지 않았는지 확인하는 데 사용되며 개인 키로 서명된 토큰의 경우 JWT의 보낸 사람이 누구인지 확인할 수도 있다.

그래서 혹여 payload를 디코딩하여 조작하면 signature이 달라지기 때문에 payload 내용을 변경해서 악용할 수 없다.

### JWT의 장점

- 토큰으로 상태관리를 하기에 따로 세션을 둘 필요가 없다.
- 로그인 정보가 사용되는 분야의 확장성이 좋아진다.
- 서버를 확장하기에 적합한 환경을 제공한다.

### JWT의 단점

- JWT는 스스로 정보를 담고 있는 토큰이므로 탈취당한다면 정보가 알려질 수 있다.
- 시간에 따라 상태값이 바뀌지 않는 stateless이므로 한번 만들어지면 제어가 불가능하다.
- 토큰의 상태를 관리하는 중앙 인증 관리 시스템이 없기 떄문에 서버에서 통제를 못한다.

### JWT로 안전하게 사용하려면?

- access 토큰과 refresh 토큰 총 두개의 토큰을 준다.
- access 토큰은 매번 인가를 받을 때 사용하고 유효기간을 짧게 준다.
- 만약 중간에 access 토큰이 탈취 당해도 유효기간이 짧기 떄문에 오래 쓰지 못하게 된다.
- refresh 토큰은 상응 값을 데이터 베이스에 저장한다. 보통 2주의 유효기간을 준다.
- 손님은 access 토큰의 수명이 다하면 refresh 토큰을 서버에 보낸다.
- 서버는 refresh 토큰 값을 대조해보고 맞다면 새 access 토큰을 발급한다.
- refresh 토큰만 안전하게 관리된다면 refresh 토큰의 유효할 동안은 다시 로그인할 필요가 없다.
- 만약 사용자를 강제 로그아웃 시키려면 refresh 토큰을 DB에서 지워버려 토큰 갱신이 안되게 하면 된다.

### 참고자료

- https://jwt.io/introduction
- https://velopert.com/2350
- https://www.youtube.com/watch?v=1QiOXWEbqYQ&ab_channel=%EC%96%84%ED%8C%8D%ED%95%9C%EC%BD%94%EB%94%A9%EC%82%AC%EC%A0%84
